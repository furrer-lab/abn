<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en, de, fr">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="abn">
<title>Model Specification: Build a Cache of Scores • abn</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Model Specification: Build a Cache of Scores">
<meta property="og:description" content="abn">
<meta property="og:image" content="http://r-bayesian-networks.org/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">abn</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.0.6</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/quick_start_example.html">Quick Start Example</a>
    <a class="dropdown-item" href="../articles/model_specification.html">Model Specification: Build a Cache of Scores</a>
    <a class="dropdown-item" href="../articles/structure_learning.html">Bayesian Network Structure Learning</a>
    <a class="dropdown-item" href="../articles/parameter_learning.html">Parameter Learning</a>
    <a class="dropdown-item" href="../articles/mixed_effect_BN_model.html">Mixed-effect Bayesian Network Model</a>
    <a class="dropdown-item" href="../articles/data_simulation.html">Data Simulation</a>
    <a class="dropdown-item" href="../articles/multiprocessing.html">Parallelisation</a>
    <a class="dropdown-item" href="../articles/paper.html">Additive Bayesian Networks</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/furrer-lab/abn/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Model Specification: Build a Cache of Scores</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/furrer-lab/abn/blob/HEAD/vignettes/model_specification.Rmd" class="external-link"><code>vignettes/model_specification.Rmd</code></a></small>
      <div class="d-none name"><code>model_specification.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://r-bayesian-networks.org">abn</a></span><span class="op">)</span></span></code></pre></div>
<p>This vignette provides an overview of the model specification process
in the <code>abn</code> package.</p>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>In a first step, the <code>abn</code> package calculates a cache of
scores of the data given each possible model. This cache is then used to
estimate the Bayesian network structure (“structure learning”) and to
estimate the parameters of the model (“parameter learning”). The cache
of scores is calculated using the <code><a href="../reference/buildScoreCache.html">buildScoreCache()</a></code>
function, which is the focus of this vignette.</p>
<p>In <code>abn</code> we distinguish between two approaches: the
Bayesian and the information-theoretic score. Only under a frequentist
framework, the package supports all possible mixtures of continuous,
discrete, and count data (see also
<code>vignette("01_quick_start_example.Rmd")</code>). Settings that are
specific to the modelling approach are set with the <code>control</code>
argument of the <code><a href="../reference/buildScoreCache.html">buildScoreCache()</a></code> function.</p>
<p>We will illustrate the model specification process using a simple
example data set and the <code><a href="../reference/buildScoreCache.html">buildScoreCache()</a></code> function.</p>
</div>
<div class="section level2">
<h2 id="estimate-the-maximum-number-of-parent-nodes">Estimate the maximum number of parent nodes<a class="anchor" aria-label="anchor" href="#estimate-the-maximum-number-of-parent-nodes"></a>
</h2>
<p>The maximum number of parent nodes for each node in the data set is a
crucial parameter to speed up the model estimation in <code>abn</code>.
It limits the number of possible combinations and thus the search space
for the model estimation. Instead of a wild guess, the maximum number of
parent nodes can be set to a reasonable value based on prior knowledge
or to the value that maximizes the score of the model given the
data.</p>
<p>In the later case, we can estimate the model’s score for different
maximum numbers of parent nodes and choose the maximum number of parent
nodes that maximizes the score of the model given the data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load only a subset of the example data for illustration</span></span>
<span><span class="va">mydat</span> <span class="op">&lt;-</span> <span class="va">ex1.dag.data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"b1"</span>, <span class="st">"p1"</span>, <span class="st">"g1"</span>, <span class="st">"b2"</span>, <span class="st">"p2"</span>, <span class="st">"b3"</span>, <span class="st">"g2"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">mydists</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>b1<span class="op">=</span><span class="st">"binomial"</span>, </span>
<span>                p1<span class="op">=</span><span class="st">"poisson"</span>, </span>
<span>                g1<span class="op">=</span><span class="st">"gaussian"</span>, </span>
<span>                b2<span class="op">=</span><span class="st">"binomial"</span>, </span>
<span>                p2<span class="op">=</span><span class="st">"poisson"</span>, </span>
<span>                b3<span class="op">=</span><span class="st">"binomial"</span>,</span>
<span>                g2<span class="op">=</span><span class="st">"gaussian"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Estimate model score for different maximum numbers of parent nodes</span></span>
<span><span class="va">num.vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">mydat</span><span class="op">)</span> <span class="co"># number of variables</span></span>
<span><span class="va">max.pars</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">num.vars</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="co"># vector of possible maximum number of parent nodes</span></span>
<span></span>
<span><span class="va">npars_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>max.pars <span class="op">=</span> <span class="va">max.pars</span>, score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">max.pars</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># data frame to store scores</span></span>
<span></span>
<span><span class="co"># loop over maximum number of parent nodes</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">max.pars</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mycache</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/buildScoreCache.html">buildScoreCache</a></span><span class="op">(</span>data.df <span class="op">=</span> <span class="va">mydat</span>, </span>
<span>                             data.dists <span class="op">=</span> <span class="va">mydists</span>,</span>
<span>                             method <span class="op">=</span> <span class="st">"bayes"</span>, </span>
<span>                             max.parents <span class="op">=</span> <span class="va">i</span><span class="op">)</span></span>
<span>  <span class="va">mp.dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mostProbable.html">mostProbable</a></span><span class="op">(</span><span class="va">mycache</span><span class="op">)</span></span>
<span>  <span class="va">myfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitAbn.html">fitAbn</a></span><span class="op">(</span><span class="va">mp.dag</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">npars_scores</span><span class="op">[</span><span class="va">i</span>, <span class="st">"score"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">myfit</span><span class="op">$</span><span class="va">mlik</span> <span class="co"># store score</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Plot the scores for different maximum numbers of parent nodes</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">npars_scores</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">max.pars</span>, y <span class="op">=</span> <span class="va">score</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Maximum number of parent nodes"</span>, y <span class="op">=</span> <span class="st">"Model score"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># set x-axis labels to integers</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">num.vars</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can see that the model score increases with the maximum number of
parent nodes up to a certain point and then remains constant. This
typical pattern indicates that the maximum number of parent nodes has
been reached at the point where the score remains constant.</p>
<p>The value of <code>max.parents</code> can be set to a single value
equal for all nodes or to a list with the node names as keys and the
maximum number of parent nodes as values as shown in
<code>vignette("01_quick_start_example.Rmd")</code>.</p>
</div>
<div class="section level2">
<h2 id="include-prior-domain-knowledge">Include prior domain knowledge<a class="anchor" aria-label="anchor" href="#include-prior-domain-knowledge"></a>
</h2>
<p>The <code>abn</code> package allows to include prior domain knowledge
in the model estimation process by defining edges and their directions
as fixed or forbidden.</p>
<p>Arcs that we are certain about can be provided with
<code>dag.retained</code>, while arcs that we are certain about not
being present can be defined with <code>dag.banned</code>. The
<code>dag.retained</code> and <code>dag.banned</code> arguments can be
set to an adjacency matrix with the node names as row- and column names.
An edge from node <code>i</code> to node <code>j</code> is indicated by
a <code>1</code> in the <code>i</code>-th row and <code>j</code>-th
column of the matrix, while a <code>0</code> indicates no edge.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the example data</span></span>
<span><span class="va">mydat</span> <span class="op">&lt;-</span> <span class="va">ex1.dag.data</span></span>
<span><span class="va">mydists</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>b1<span class="op">=</span><span class="st">"binomial"</span>, </span>
<span>                p1<span class="op">=</span><span class="st">"poisson"</span>, </span>
<span>                g1<span class="op">=</span><span class="st">"gaussian"</span>, </span>
<span>                b2<span class="op">=</span><span class="st">"binomial"</span>, </span>
<span>                p2<span class="op">=</span><span class="st">"poisson"</span>, </span>
<span>                b3<span class="op">=</span><span class="st">"binomial"</span>, </span>
<span>                g2<span class="op">=</span><span class="st">"gaussian"</span>, </span>
<span>                b4<span class="op">=</span><span class="st">"binomial"</span>, </span>
<span>                b5<span class="op">=</span><span class="st">"binomial"</span>, </span>
<span>                g3<span class="op">=</span><span class="st">"gaussian"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define edges and their directions as fixed or forbidden</span></span>
<span><span class="va">dag.banned</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="fl">10</span>, ncol <span class="op">=</span> <span class="fl">10</span>, dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mydat</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mydat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define edges and their directions as forbidden</span></span>
<span><span class="va">dag.banned</span><span class="op">[</span><span class="st">"b1"</span>, <span class="st">"b2"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">dag.banned</span><span class="op">[</span><span class="st">"b1"</span>, <span class="st">"b3"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">dag.banned</span><span class="op">[</span><span class="st">"b1"</span>, <span class="st">"b4"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># Display the matrix</span></span>
<span><span class="va">dag.banned</span></span>
<span></span>
<span><span class="co"># Plot the forbidden edges</span></span>
<span><span class="fu"><a href="../reference/plotAbn.html">plotAbn</a></span><span class="op">(</span>dag <span class="op">=</span> <span class="va">dag.banned</span>, data.dists <span class="op">=</span> <span class="va">mydists</span><span class="op">)</span></span></code></pre></div>
<p>The plot shows the forbidden edges defined in the
<code>dag.banned</code> matrix.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Matteo Delucchi, Reinhard Furrer, Gilles Kratzer, Fraser Iain Lewis.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
