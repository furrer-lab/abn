<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en, de, fr">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="abn">
<title>Parallelisation • abn</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Parallelisation">
<meta property="og:description" content="abn">
<meta property="og:image" content="http://r-bayesian-networks.org/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">abn</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.0.6</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/quick_start_example.html">Quick Start Example</a>
    <a class="dropdown-item" href="../articles/model_specification.html">Model Specification: Build a Cache of Scores</a>
    <a class="dropdown-item" href="../articles/structure_learning.html">Bayesian Network Structure Learning</a>
    <a class="dropdown-item" href="../articles/parameter_learning.html">Parameter Learning</a>
    <a class="dropdown-item" href="../articles/mixed_effect_BN_model.html">Mixed-effect Bayesian Network Model</a>
    <a class="dropdown-item" href="../articles/data_simulation.html">Data Simulation</a>
    <a class="dropdown-item" href="../articles/multiprocessing.html">Parallelisation</a>
    <a class="dropdown-item" href="../articles/paper.html">Additive Bayesian Networks</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/furrer-lab/abn/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Parallelisation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/furrer-lab/abn/blob/HEAD/vignettes/multiprocessing.Rmd" class="external-link"><code>vignettes/multiprocessing.Rmd</code></a></small>
      <div class="d-none name"><code>multiprocessing.Rmd</code></div>
    </div>

    
    
<p>This vignette provides an overview of parallel computation in R with
the <code>parallel</code> package, focusing on its implementation in the
<code>abn</code> package. We will also discuss the difference between
the concepts of the “FORK” and “PSOCK” parallelisation methods.</p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>abn</code> package allows for efficient modelling of
additive Bayesian networks. Certain steps in its workflow, such as
computing the score cache, are well-suited for parallel execution. The
score cache stores the scores of all possible parent sets for each node
in the network. By running computations for multiple combinations
simultaneously across different cores, we can significantly speed up
this process. The <code>abn</code> package uses the parallel package to
achieve this.</p>
<div class="section level3">
<h3 id="fork-vs--psock">FORK vs. PSOCK<a class="anchor" aria-label="anchor" href="#fork-vs--psock"></a>
</h3>
<p>The <code>parallel</code> package in R offers two main types of
parallelisation:</p>
<ul>
<li><p><em>FORK</em>: Predominantly used on Unix-based systems
(including Linux and Mac OS), with FORK a parent process creates child
processes that are a copy of the parent process. The key advantage of
FORK is that it shares memory objects between the processes, which can
lead to significant efficiencies when dealing with large
objects.</p></li>
<li><p><em>PSOCK</em>: Used on all systems, including Windows, PSOCK
creates a set of independent R processes and communicates between them
using sockets. Each PSOCK worker is a separate R process, and there is
no memory sharing between workers resulting in a higher memory overhead
compared to FORK.</p></li>
</ul>
<p>The choice between FORK and PSOCK depends on the operating system and
the specific use case.</p>
</div>
</div>
<div class="section level2">
<h2 id="parallelisation-in-the-abn-package">Parallelisation in the <code>abn</code> package<a class="anchor" aria-label="anchor" href="#parallelisation-in-the-abn-package"></a>
</h2>
<p>To illustrate the difference between FORK and PSOCK, we will compare
their performance under both Bayesian and frequentist approaches. We
will use the <code>microbenchmark</code> package to measure the time it
takes to compute the score cache for a given data set and
parameters.</p>
<div class="section level3">
<h3 id="load-the-data-and-specify-the-parameters">Load the data and specify the parameters<a class="anchor" aria-label="anchor" href="#load-the-data-and-specify-the-parameters"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://r-bayesian-networks.org">abn</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/joshuaulrich/microbenchmark/" class="external-link">microbenchmark</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123456</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Prepare data and parameters</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">FCV</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">mydists</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>FCV <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>                FHV_1 <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>                C_felis <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>                M_felis <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>                B_bronchiseptica <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>                FeLV <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>                FIV <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>                Gingivostomatitis <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>                URTD <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>                Vaccinated <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>                Pedigree<span class="op">=</span><span class="st">"binomial"</span>,</span>
<span>                Outdoor<span class="op">=</span><span class="st">"binomial"</span>,</span>
<span>                GroupSize<span class="op">=</span><span class="st">"poisson"</span>,</span>
<span>                Age<span class="op">=</span><span class="st">"gaussian"</span><span class="op">)</span></span>
<span><span class="va">maxparents</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">ncores</span> <span class="op">&lt;-</span> <span class="fl">2</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="benchmarking">Benchmarking<a class="anchor" aria-label="anchor" href="#benchmarking"></a>
</h3>
<p>We compare the following methods:</p>
<ul>
<li>
<code>mleSinglecore</code>: Maximum likelihood estimation with
single core</li>
<li>
<code>mleMulticorePSOCK</code>: Maximum likelihood estimation on 2
cores using PSOCK</li>
<li>
<code>mleMulticoreFORK</code>: Maximum likelihood estimation on 2
cores using FORK</li>
<li>
<code>bayesSinglecore</code>: Bayesian estimation with single
core</li>
<li>
<code>bayesMulticorePSOCK</code>: Bayesian estimation on 2 cores
using PSOCK</li>
<li>
<code>bayesMulticoreFORK</code>: Bayesian estimation on 2 cores
using FORK</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Benchmark</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span>mleSinglecore <span class="op">=</span> <span class="fu"><a href="../reference/buildScoreCache.html">buildScoreCache</a></span><span class="op">(</span>data.df <span class="op">=</span> <span class="va">df</span>,</span>
<span>                                               data.dists <span class="op">=</span> <span class="va">mydists</span>,</span>
<span>                                               method <span class="op">=</span> <span class="st">"mle"</span>,</span>
<span>                                               max.parents <span class="op">=</span> <span class="va">maxparents</span>,</span>
<span>                                               control <span class="op">=</span> <span class="fu"><a href="../reference/build.control.html">build.control</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"mle"</span>,</span>
<span>                                                                       ncores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               mleMulticorePSOCK <span class="op">=</span> <span class="fu"><a href="../reference/buildScoreCache.html">buildScoreCache</a></span><span class="op">(</span>data.df <span class="op">=</span> <span class="va">df</span>,</span>
<span>                                                   data.dists <span class="op">=</span> <span class="va">mydists</span>,</span>
<span>                                                   method <span class="op">=</span> <span class="st">"mle"</span>,</span>
<span>                                                   max.parents <span class="op">=</span> <span class="va">maxparents</span>,</span>
<span>                                                   control <span class="op">=</span> <span class="fu"><a href="../reference/build.control.html">build.control</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"mle"</span>,</span>
<span>                                                                           ncores <span class="op">=</span> <span class="va">ncores</span>,</span>
<span>                                                                           cluster.type <span class="op">=</span> <span class="st">"PSOCK"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               mleMulticoreFORK <span class="op">=</span> <span class="fu"><a href="../reference/buildScoreCache.html">buildScoreCache</a></span><span class="op">(</span>data.df <span class="op">=</span> <span class="va">df</span>,</span>
<span>                                                  data.dists <span class="op">=</span> <span class="va">mydists</span>,</span>
<span>                                                  method <span class="op">=</span> <span class="st">"mle"</span>,</span>
<span>                                                  max.parents <span class="op">=</span> <span class="va">maxparents</span>,</span>
<span>                                                  control <span class="op">=</span> <span class="fu"><a href="../reference/build.control.html">build.control</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"mle"</span>,</span>
<span>                                                                          ncores <span class="op">=</span> <span class="va">ncores</span>,</span>
<span>                                                                          cluster.type <span class="op">=</span> <span class="st">"FORK"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               bayesSinglecore <span class="op">=</span> <span class="fu"><a href="../reference/buildScoreCache.html">buildScoreCache</a></span><span class="op">(</span>data.df <span class="op">=</span> <span class="va">df</span>,</span>
<span>                                                 data.dists <span class="op">=</span> <span class="va">mydists</span>,</span>
<span>                                                 method <span class="op">=</span> <span class="st">"bayes"</span>,</span>
<span>                                                 max.parents <span class="op">=</span> <span class="va">maxparents</span>,</span>
<span>                                                 control <span class="op">=</span> <span class="fu"><a href="../reference/build.control.html">build.control</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"bayes"</span>,</span>
<span>                                                                         ncores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               bayesMulticorePSOCK <span class="op">=</span> <span class="fu"><a href="../reference/buildScoreCache.html">buildScoreCache</a></span><span class="op">(</span>data.df <span class="op">=</span> <span class="va">df</span>,</span>
<span>                                                     data.dists <span class="op">=</span> <span class="va">mydists</span>,</span>
<span>                                                     method <span class="op">=</span> <span class="st">"bayes"</span>,</span>
<span>                                                     max.parents <span class="op">=</span> <span class="va">maxparents</span>,</span>
<span>                                                     control <span class="op">=</span> <span class="fu"><a href="../reference/build.control.html">build.control</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"bayes"</span>,</span>
<span>                                                                             ncores <span class="op">=</span> <span class="va">ncores</span>,</span>
<span>                                                                             cluster.type <span class="op">=</span> <span class="st">"PSOCK"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               bayesMulticoreFORK <span class="op">=</span> <span class="fu"><a href="../reference/buildScoreCache.html">buildScoreCache</a></span><span class="op">(</span>data.df <span class="op">=</span> <span class="va">df</span>,</span>
<span>                                                    data.dists <span class="op">=</span> <span class="va">mydists</span>,</span>
<span>                                                    method <span class="op">=</span> <span class="st">"bayes"</span>,</span>
<span>                                                    max.parents <span class="op">=</span> <span class="va">maxparents</span>,</span>
<span>                                                    control <span class="op">=</span> <span class="fu"><a href="../reference/build.control.html">build.control</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"bayes"</span>,</span>
<span>                                                                            ncores <span class="op">=</span> <span class="va">ncores</span>,</span>
<span>                                                                            cluster.type <span class="op">=</span> <span class="st">"FORK"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               times <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="benchmarkBoxPlot-1.png" alt="plot of chunk benchmarkBoxPlot"><div class="figcaption">plot of chunk benchmarkBoxPlot</div>
</div>
<p>The boxplot illustrates the time distribution for computing the score
cache using different methods.</p>
<p>We can see that the Bayesian approach is generally faster than the
frequentist approach. This is due to the efficient implementation of the
score cache computation in the Bayesian approach. It leverages either an
internal C/C++ implementation or INLA, an efficient implementation of
the Bayesian approach. The method selection, by default, is automatic
and depends on the specific use case. The frequentist approach on the
other hand relies on other R packages, which introduces a higher
overhead.</p>
<p>The multicore approach is generally faster than the singlecore
approach. This is particularly noticeable for the frequentist approach,
where both multicore methods surpass the singlecore method in speed. The
Bayesian approach is already highly efficient, so the gain from using
multiple cores is not as pronounced.</p>
<p>For the Bayesian approach, the FORK method is generally faster than
the PSOCK method. This is because the FORK method shares memory objects
between the processes, leading to significant efficiencies with large
objects. In contrast, the PSOCK method creates a set of independent R
processes and communicates between them using sockets, which introduces
a higher memory overhead. For this example, the difference to the single
core approach is not significant, likely because the problem is not
large enough to greatly benefit from parallelization.</p>
<p>Interestingly, for the frequentist approach, the PSOCK method appears
to be generally faster than the FORK method. This can occur when the
overhead of copying large objects in memory outweighs the benefits of
shared memory in the FORK method.</p>
<p>In conclusion, while the Bayesian approach is generally faster than
the frequentist approach, the speed up is larger in the frequentist
approach. However, the choice between FORK and PSOCK depends on the
operating system and the specific use case.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Matteo Delucchi, Reinhard Furrer, Gilles Kratzer, Fraser Iain Lewis.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
