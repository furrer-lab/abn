<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en, de, fr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Iterates over all valid parent combinations - subject to ban, retain, and max.parent limits - for each node, or a subset of nodes, and computes a cache of scores (AIC, BIC, log marginal likelihood).
This cache can then be used in different DAG structural search algorithms."><title>Build a cache of goodness of fit metrics for each node in a DAG, possibly subject to user-defined restrictions — buildScoreCache • abn</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Build a cache of goodness of fit metrics for each node in a DAG, possibly subject to user-defined restrictions — buildScoreCache"><meta property="og:description" content="Iterates over all valid parent combinations - subject to ban, retain, and max.parent limits - for each node, or a subset of nodes, and computes a cache of scores (AIC, BIC, log marginal likelihood).
This cache can then be used in different DAG structural search algorithms."><meta property="og:image" content="http://r-bayesian-networks.org/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">abn</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.0.6</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/quick_start_example.html">Quick Start Example</a>
    <a class="dropdown-item" href="../articles/model_specification.html">Model Specification: Build a Cache of Scores</a>
    <a class="dropdown-item" href="../articles/structure_learning.html">Bayesian Network Structure Learning</a>
    <a class="dropdown-item" href="../articles/parameter_learning.html">Parameter Learning</a>
    <a class="dropdown-item" href="../articles/mixed_effect_BN_model.html">Mixed-effect Bayesian Network Model</a>
    <a class="dropdown-item" href="../articles/data_simulation.html">Data Simulation</a>
    <a class="dropdown-item" href="../articles/multiprocessing.html">Parallelisation</a>
    <a class="dropdown-item" href="../articles/paper.html">Additive Bayesian Networks</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/furrer-lab/abn/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Build a cache of goodness of fit metrics for each node in a DAG, possibly subject to user-defined restrictions</h1>
      <small class="dont-index">Source: <a href="https://github.com/furrer-lab/abn/blob/HEAD/R/build_score_cache.R" class="external-link"><code>R/build_score_cache.R</code></a>, <a href="https://github.com/furrer-lab/abn/blob/HEAD/R/build_score_cache_bayes.R" class="external-link"><code>R/build_score_cache_bayes.R</code></a>, <a href="https://github.com/furrer-lab/abn/blob/HEAD/R/build_score_cache_mle.R" class="external-link"><code>R/build_score_cache_mle.R</code></a></small>
      <div class="d-none name"><code>buildScoreCache.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Iterates over all valid parent combinations - subject to ban, retain, and <code>max.parent</code> limits - for each node, or a subset of nodes, and computes a cache of scores (AIC, BIC, log marginal likelihood).
This cache can then be used in different DAG structural search algorithms.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">buildScoreCache</span><span class="op">(</span>data.df <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>data.dists <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>method <span class="op">=</span> <span class="st">"bayes"</span>,</span>
<span>group.var <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>adj.vars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>cor.vars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>dag.banned <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>dag.retained <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>max.parents <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>which.nodes <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>defn.res <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>centre <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>dry.run <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>control <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>debugging <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span><span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">buildScoreCache.bayes</span><span class="op">(</span></span>
<span>  data.df <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  data.dists <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  group.var <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cor.vars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dag.banned <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dag.retained <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  max.parents <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  which.nodes <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  defn.res <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dry.run <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  centre <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  force.method <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  mylist <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  grouped.vars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  group.ids <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="build.control.html">build.control</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"bayes"</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  debugging <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">forLoopContentBayes</span><span class="op">(</span></span>
<span>  row.no <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  children <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  node.defn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dag.m <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  force.method <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  data.df <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  data.dists <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  var.types <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  control <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  grouped.vars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  group.ids <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">forLoopContent</span><span class="op">(</span></span>
<span>  <span class="va">row.num</span>,</span>
<span>  <span class="va">mycache</span>,</span>
<span>  <span class="va">data.dists</span>,</span>
<span>  <span class="va">data.df.multi</span>,</span>
<span>  <span class="va">adj.vars</span>,</span>
<span>  <span class="va">data.df</span>,</span>
<span>  <span class="va">data.df.lvl</span>,</span>
<span>  <span class="va">group.var</span>,</span>
<span>  <span class="va">group.ids</span>,</span>
<span>  <span class="va">control</span>,</span>
<span>  <span class="va">n</span>,</span>
<span>  <span class="va">verbose</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">buildScoreCache.mle</span><span class="op">(</span></span>
<span>  data.df <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  data.dists <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  max.parents <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  adj.vars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cor.vars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dag.banned <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dag.retained <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  which.nodes <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  centre <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  defn.res <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dry.run <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  debugging <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  force.method <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  group.var <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  grouped.vars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  group.ids <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="build.control.html">build.control</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"mle"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data.df</dt>
<dd><p>a data frame containing the data used for learning each node. Binary variables must be declared as factors.</p></dd>


<dt>data.dists</dt>
<dd><p>a named list giving the distribution for each node in the network, see ‘Details’.</p></dd>


<dt>method</dt>
<dd><p>should a "Bayes" or "mle" approach be used, see ‘Details’.</p></dd>


<dt>group.var</dt>
<dd><p>variable name for nodes to be fitted as variable intercept as in a mixed-effects model ("Bayes" and "mle") and gives the column name in <code>data.df</code> of the grouping variable which must be a factor denoting group membership.</p></dd>


<dt>adj.vars</dt>
<dd><p>a character vector giving the column names in <code>data.df</code> for which the network score has to be adjusted for, see ‘Details’.</p></dd>


<dt>cor.vars</dt>
<dd><p>a character vector giving the column names in <code>data.df</code> for which a mixed model should be used to adjust for within group correlation or pure adjustment ("bayes" only).</p></dd>


<dt>dag.banned</dt>
<dd><p>a matrix or a formula statement (see ‘Details’ for format) defining which arcs are not permitted - banned - see ‘Details’ for format. Note that colnames and rownames must be set, otherwise same row/column names as data.df will be assumed. If set as NULL an empty matrix is assumed.</p></dd>


<dt>dag.retained</dt>
<dd><p>a matrix or a formula statement (see ‘Details’ for format) defining which arcs are must be retained in any model search, see ‘Details’ for format. Note that colnames and rownames must be set, otherwise same row/column names as data.df will be assumed. If set as NULL an empty matrix is assumed.</p></dd>


<dt>max.parents</dt>
<dd><p>a constant or named list giving the maximum number of parents allowed, the list version allows this to vary per node (only for <code>method="bayes"</code>. A constant can be a single integer, a numeric vector of the length of variables with the same integer for all variable (e.g. <code>c(2,2)</code>) or a named list with all values being the same (e.g. <code>list("A"=2, "B"=2)</code>).</p></dd>


<dt>which.nodes</dt>
<dd><p>a vector giving the column indices of the variables to be included, if ignored all variables are included. This is used to subset <code>data.df</code>.</p></dd>


<dt>defn.res</dt>
<dd><p>an optional user-supplied list of child and parent combinations, see ‘Details’.</p></dd>


<dt>centre</dt>
<dd><p>should the observations in each Gaussian node first be standardized to mean zero and standard deviation one, defaults to TRUE.</p></dd>


<dt>dry.run</dt>
<dd><p>if TRUE then a list of the child nodes and parent combinations are returned but without estimation of node scores (log marginal likelihoods).</p></dd>


<dt>control</dt>
<dd><p>a list of control parameters. See <code><a href="build.control.html">build.control</a></code> for the names of the settable control values and their effect.</p></dd>


<dt>verbose</dt>
<dd><p>if TRUE then provides some additional output.</p></dd>


<dt>debugging</dt>
<dd><p>if <code>TRUE</code> and <code>method = 'mle'</code> this enables to step into the for-loop.</p></dd>


<dt>...</dt>
<dd><p>additional arguments passed for optimization.</p></dd>


<dt>force.method</dt>
<dd><p>"notset", "INLA" or "C". This is specified in <code>buildScoreCache(control=list(max.mode.error=...))</code>.</p></dd>


<dt>mylist</dt>
<dd><p>result returned from <code><a href="check.valid.data.html">check.valid.data</a></code>.</p></dd>


<dt>grouped.vars</dt>
<dd><p>result returned from <code><a href="check.valid.groups.html">check.valid.groups</a></code>.</p></dd>


<dt>group.ids</dt>
<dd><p>result returned from <code><a href="check.valid.groups.html">check.valid.groups</a></code>.</p></dd>


<dt>row.no</dt>
<dd><p>The row number of the child-parent combination to be processed.</p></dd>


<dt>children</dt>
<dd><p>vector of child node integers.</p></dd>


<dt>node.defn</dt>
<dd><p>child-parent combination table.</p></dd>


<dt>dag.m</dt>
<dd><p>Empty adjacency matrix.</p></dd>


<dt>var.types</dt>
<dd><p>vector of numeric encoding of distribution types. See <code>get.var.types(data.dists)</code></p></dd>


<dt>row.num</dt>
<dd><p>number of child-node (mostly corresponds to child node index e.g. in dag).</p></dd>


<dt>mycache</dt>
<dd><p>prepared cache.</p></dd>


<dt>data.df.multi</dt>
<dd><p>extended data.df for one-hot-encoded multinomial variables.</p></dd>


<dt>data.df.lvl</dt>
<dd><p>copy of original <code>data.df</code>.</p></dd>


<dt>n</dt>
<dd><p>corresponds to <code>nvars</code>, number of variables in data.dists.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A named list of class <code>abnCache</code>.</p><dl><dt><code>children</code></dt>
<dd><p>a vector of the child node indexes (from 1) corresponding to the columns in data.df (ignoring any grouping variable)</p></dd>

<dt><code>node.defn</code></dt>
<dd><p>a matrix giving the parent combination</p></dd>

<dt><code>mlik</code></dt>
<dd><p>log marginal likelihood value for each node combination. If the model cannot be fitted then NA is returned.</p></dd>

<dt><code>error.code</code></dt>
<dd><p>if non-zero then either the root finding algorithm (glm nodes) or the maximisation algorithm (glmm nodes) terminated in an unusual way suggesting a possible unreliable result, or else the finite difference hessian estimation produced and error or warning (glmm nodes). NULL if <code>method="mle"</code>.</p></dd>

<dt><code>error.code.desc</code></dt>
<dd><p>a textual description of the <code>error.code</code>. NULL if <code>method="mle"</code></p></dd>

<dt><code>hessian.accuracy</code></dt>
<dd><p>An estimate of the error in the final mlik value for each parent combination - this is the absolute difference between two different adaptive finite difference rules where each computes the mlik value. NULL if <code>method="mle"</code></p></dd>

<dt><code>data.df</code></dt>
<dd><p>a version of the original data (for internal use only in other functions such as <code><a href="mostProbable.html">mostProbable</a></code>).</p></dd>

<dt><code>data.dists</code></dt>
<dd><p>the named list of nodes distributions (for internal use only in other functions such as <code><a href="mostProbable.html">mostProbable</a></code>).</p></dd>

<dt><code>max.parents</code></dt>
<dd><p>the maximum number of parents (for internal use only in other functions such as <code><a href="mostProbable.html">mostProbable</a></code>).</p></dd>

<dt><code>dag.retained</code></dt>
<dd><p>the matrix encoding the retained arcs (for internal use only in other functions such as <code><a href="searchHeuristic.html">searchHeuristic</a></code>).</p></dd>

<dt><code>dag.banned</code></dt>
<dd><p>the matrix encoding the banned arcs (for internal use only in other functions such as <code><a href="searchHeuristic.html">searchHeuristic</a></code>).</p></dd>

<dt><code>aic</code></dt>
<dd><p>aic value for each node combination. If the model cannot be fitted then NaN is returned. NULL if <code>method="bayes"</code>.</p></dd>

<dt><code>bic</code></dt>
<dd><p>bic value for each node combination. If the model cannot be fitted then NaN is returned. NULL if <code>method="bayes"</code>.</p></dd>

<dt><code>mdl</code></dt>
<dd><p>mdl value for each node combination. If the model cannot be fitted then NaN is returned. NULL if <code>method="bayes"</code>.</p></dd>


</dl><p>Named vector of results from one child-parent combination subject to the <code>row.no</code>.
The names are:</p><dl><dt>childParentCombNo</dt>
<dd><p>The row number of the child-parent combination in the <code>node.defn</code> table.
This must be the same as the row number in <code>node.defn</code>:
careful if <code>buildScoreCache.bayes()</code> is run in parallel!</p></dd>

<dt>mlik</dt>
<dd><p>The marginal log-likelihood of the child-parent combination.</p></dd>

<dt>error.code</dt>
<dd><p>The error code returned by <code>inla()</code>.</p></dd>

<dt>hessian.accuracy</dt>
<dd><p>The accuracy of the Hessian matrix returned by <code>inla()</code>.</p></dd>

<dt>used.INLA</dt>
<dd><p>A logical value indicating whether <code>inla()</code> was used to fit the model.</p></dd>


</dl><p>list</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function computes a cache of scores based on possible restrictions (maximum complexity, retained and banned arcs).
This function is very similar to <code><a href="fitAbn.html">fitAbn</a></code> - see that help page for details of the type of models used and in particular <code>data.dists</code> specification - but rather than fit a single complete DAG <code>buildScoreCache</code> iterates over all different parent combinations for each node, creating a cache of scores.
This cache of score could be used to select the optimal network in other function such as <code><a href="searchHeuristic.html">searchHeuristic</a></code> or <code><a href="mostProbable.html">mostProbable</a></code>.
‘dag.banned’ and ‘dag.retained’ specify which arcs are forced to be absent or present in the DAG, respectively.
If provided as matrix, rows represent child nodes and columns their parents for elements with a value $=1$.</p>
<p>Two very different approaches are implemented: a Bayesian and frequentist approaches. They can be selected using the <code>method</code> argument.</p><div class="section">
<h3 id="if-method-bayes-">If <code>method="bayes"</code>:<a class="anchor" aria-label="anchor" href="#if-method-bayes-"></a></h3>


<p>This function is used to calculate all individual node scores (log marginal likelihoods).
Internal code is used by default for numerical estimation in nodes without random effects, and INLA is the default for nodes with random effects.
This default behavior can be overridden using <code>control=list(max.mode.error=...)</code>. The default is <code>max.mode.error=10</code>, which means that the modes estimated from INLA output must be within 10\<!-- % of those estimated using internal code. -->
Otherwise, the internal code is used rather than INLA.
To force the use of INLA on all nodes, use max.mode.error=100, which then ignores this check, to force the use of internal code then use <code>max.mode.error=0</code>. For more detials, see <a href="fitAbn.html">fitAbn</a>.
The variable <code>which.nodes</code> is to allow the computation to be separated by node, for example, over different CPUs using say <code>R CMD BATCH</code>.
This may useful and indeed likely essential with larger problems or those with random effects.
Note that in this case, the results must then be combined back into a list of identical formats to that produced by an individual call to <code>buildScoreCache</code>,
comprising of all nodes (in the same order as the columns in <code>data.df</code>) before sending it to any search routines. Using <code>dry.run</code> can be useful here.</p>
</div>

<div class="section">
<h3 id="if-method-mle-">If <code>method="mle"</code>:<a class="anchor" aria-label="anchor" href="#if-method-mle-"></a></h3>


<p>This function is used to calculate all individual information-theoretic node scores. The possible information-theoretic based network scores computed in <code>buildScoreCache</code> are the maximum likelihood (mlik, called marginal likelihood in this context as it is computed node wise),
the Akaike Information Criteria (aic), the Bayesian Information Criteria (bic) and the Minimum distance Length (mdl). The classical definitions of those metrics are given in Kratzer and Furrer (2018). This function computes a cache that can be fed into a model search algorithm.
The numerical routines used here are identical to those in <code><a href="fitAbn.html">fitAbn</a></code> and see that help page for further details and also the quality assurance section on the <a href="http://r-bayesian-networks.org/">r-bayesian-networks.org</a> of the <span class="pkg">abn</span> website for more details.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="functions">Functions<a class="anchor" aria-label="anchor" href="#functions"></a></h2>
    
<ul><li><p><code>buildScoreCache.bayes()</code>: Fit a given DAG to data with method="bayes".</p></li>
<li><p><code>forLoopContentBayes()</code>: Internal function called by <code>buildScoreCache.bayes()</code>.</p></li>
<li><p><code>forLoopContent()</code>: Internal function called by <code>buildScoreCache.mle()</code>.</p></li>
<li><p><code>buildScoreCache.mle()</code>: Fit a given DAG to data with method="mle".</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Kratzer, Gilles, Fraser Lewis, Arianna Comin, Marta Pittavino, and Reinhard Furrer. “Additive Bayesian Network Modeling with the R Package Abn.” Journal of Statistical Software 105 (January 28, 2023): 1–41. https://doi.org/10.18637/jss.v105.i08.</p>
<p>Kratzer, G., Lewis, F.I., Comin, A., Pittavino, M., and Furrer, R. (2019). "Additive Bayesian Network Modelling with the R Package abn". arXiv:1911.09006.</p>
<p>Kratzer, G., and Furrer, R., (2018). "Information-Theoretic Scoring Rules to Learn Additive Bayesian Network Applied to Epidemiology". arXiv:1808.01126.</p>
<p>Lewis, F. I., and McCormick, B. J. J. (2012). "Revealing the complexity of health determinants in resource poor settings". <em>American Journal Of Epidemiology</em>. doi:10.1093/aje/KWS183).</p>
<p>Further information about <span class="pkg">abn</span> can be found at: <a href="http://r-bayesian-networks.org/">r-bayesian-networks.org</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="fitAbn.html">fitAbn</a></code></p>
<p>Other buildScoreCache: 
<code><a href="build.control.html">build.control</a>()</code></p>
<p>Other Bayes: 
<code><a href="calc.node.inla.glm.html">calc.node.inla.glm</a>()</code>,
<code><a href="calc.node.inla.glmm.html">calc.node.inla.glmm</a>()</code>,
<code><a href="fitAbn.html">fitAbn</a>()</code>,
<code><a href="getmarginals.html">getmarginals</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Simple example</span></span></span>
<span class="r-in"><span><span class="co"># Generate data</span></span></span>
<span class="r-in"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">1e6</span></span></span>
<span class="r-in"><span><span class="va">mydists</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a<span class="op">=</span><span class="st">"gaussian"</span>,</span></span>
<span class="r-in"><span>                b<span class="op">=</span><span class="st">"gaussian"</span>,</span></span>
<span class="r-in"><span>                c<span class="op">=</span><span class="st">"gaussian"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">N</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">+</span> <span class="fl">2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">N</span>, mean <span class="op">=</span> <span class="fl">5</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">c</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">+</span> <span class="fl">1</span><span class="op">*</span><span class="va">a</span> <span class="op">+</span> <span class="fl">2</span><span class="op">*</span><span class="va">b</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">N</span>, mean <span class="op">=</span> <span class="fl">2</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mydf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"a"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   <span class="st">"b"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   <span class="st">"c"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">c</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ABN with MLE</span></span></span>
<span class="r-in"><span><span class="va">mycache.mle</span> <span class="op">&lt;-</span> <span class="fu">buildScoreCache</span><span class="op">(</span>data.df <span class="op">=</span> <span class="va">mydf</span>,</span></span>
<span class="r-in"><span>                               data.dists <span class="op">=</span> <span class="va">mydists</span>,</span></span>
<span class="r-in"><span>                               method <span class="op">=</span> <span class="st">"mle"</span>,</span></span>
<span class="r-in"><span>                            max.parents <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: Matrix</span>
<span class="r-in"><span><span class="va">dag.mle</span> <span class="op">&lt;-</span> <span class="fu"><a href="mostProbable.html">mostProbable</a></span><span class="op">(</span>score.cache <span class="op">=</span> <span class="va">mycache.mle</span>,</span></span>
<span class="r-in"><span>                        max.parents <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Step1. completed max alpha_i(S) for all i and S</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total sets g(S) to be evaluated over: 8</span>
<span class="r-in"><span><span class="va">myfit.mle</span> <span class="op">&lt;-</span> <span class="fu"><a href="fitAbn.html">fitAbn</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">dag.mle</span>,</span></span>
<span class="r-in"><span>                    method <span class="op">=</span> <span class="st">"mle"</span>,</span></span>
<span class="r-in"><span>                    max.parents <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">myfit.mle</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="buildScoreCache-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># ABN with Bayes</span></span></span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"INLA"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># Run only if INLA is available</span></span></span>
<span class="r-in"><span>  <span class="va">mycache.bayes</span> <span class="op">&lt;-</span> <span class="fu">buildScoreCache</span><span class="op">(</span>data.df <span class="op">=</span> <span class="va">mydf</span>,</span></span>
<span class="r-in"><span>                                   data.dists <span class="op">=</span> <span class="va">mydists</span>,</span></span>
<span class="r-in"><span>                                   method <span class="op">=</span> <span class="st">"bayes"</span>,</span></span>
<span class="r-in"><span>                                   max.parents <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">dag.bayes</span> <span class="op">&lt;-</span> <span class="fu"><a href="mostProbable.html">mostProbable</a></span><span class="op">(</span>score.cache <span class="op">=</span> <span class="va">mycache.bayes</span>,</span></span>
<span class="r-in"><span>                            max.parents <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">myfit.bayes</span> <span class="op">&lt;-</span> <span class="fu"><a href="fitAbn.html">fitAbn</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">dag.bayes</span>,</span></span>
<span class="r-in"><span>                        method <span class="op">=</span> <span class="st">"bayes"</span>,</span></span>
<span class="r-in"><span>                        max.parents <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">myfit.bayes</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="co"># Compare MLE and Bayes with lm</span></span></span>
<span class="r-in"><span><span class="va">mymod.lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">c</span> <span class="op">~</span> <span class="va">a</span> <span class="op">+</span> <span class="va">b</span>, data <span class="op">=</span> <span class="va">mydf</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mymod.lm</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##################################################################################################</span></span></span>
<span class="r-in"><span><span class="co">## Example 1 - "mle" vs. "bayes" and the later with using the internal C routine compared to INLA</span></span></span>
<span class="r-in"><span><span class="co">##################################################################################################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Subset of the build-in dataset, see  ?ex0.dag.data</span></span></span>
<span class="r-in"><span><span class="va">mydat</span> <span class="op">&lt;-</span> <span class="va">ex0.dag.data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"b1"</span>,<span class="st">"b2"</span>,<span class="st">"g1"</span>,<span class="st">"g2"</span>,<span class="st">"b3"</span>,<span class="st">"g3"</span><span class="op">)</span><span class="op">]</span> <span class="co">## take a subset of cols</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># setup distribution list for each node</span></span></span>
<span class="r-in"><span><span class="va">mydists</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>b1<span class="op">=</span><span class="st">"binomial"</span>, b2<span class="op">=</span><span class="st">"binomial"</span>, g1<span class="op">=</span><span class="st">"gaussian"</span>,</span></span>
<span class="r-in"><span>                g2<span class="op">=</span><span class="st">"gaussian"</span>, b3<span class="op">=</span><span class="st">"binomial"</span>, g3<span class="op">=</span><span class="st">"gaussian"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Structural constraints</span></span></span>
<span class="r-in"><span><span class="co">## ban arc from b2 to b1</span></span></span>
<span class="r-in"><span><span class="co">## always retain arc from g2 to g1</span></span></span>
<span class="r-in"><span><span class="co">## parent limits - can be specified for each node separately</span></span></span>
<span class="r-in"><span><span class="va">max.par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"b1"</span><span class="op">=</span><span class="fl">2</span>, <span class="st">"b2"</span><span class="op">=</span><span class="fl">2</span>, <span class="st">"g1"</span><span class="op">=</span><span class="fl">2</span>, <span class="st">"g2"</span><span class="op">=</span><span class="fl">2</span>, <span class="st">"b3"</span><span class="op">=</span><span class="fl">2</span>, <span class="st">"g3"</span><span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># now build the cache of pre-computed scores accordingly to the structural constraints</span></span></span>
<span class="r-in"><span><span class="va">res.c</span> <span class="op">&lt;-</span> <span class="fu">buildScoreCache</span><span class="op">(</span>data.df<span class="op">=</span><span class="va">mydat</span>,</span></span>
<span class="r-in"><span>                         data.dists<span class="op">=</span><span class="va">mydists</span>,</span></span>
<span class="r-in"><span>                         dag.banned<span class="op">=</span> <span class="op">~</span><span class="va">b1</span><span class="op">|</span><span class="va">b2</span>,</span></span>
<span class="r-in"><span>                         dag.retained<span class="op">=</span> <span class="op">~</span><span class="va">g1</span><span class="op">|</span><span class="va">g2</span>,</span></span>
<span class="r-in"><span>                         max.parents<span class="op">=</span><span class="va">max.par</span>,</span></span>
<span class="r-in"><span>                         method<span class="op">=</span><span class="st">"bayes"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># repeat but using R-INLA. The mlik's should be virtually identical.</span></span></span>
<span class="r-in"><span><span class="co"># Force using of INLA build.control(max.mode.error=100)</span></span></span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"INLA"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">res.inla</span> <span class="op">&lt;-</span> <span class="fu">buildScoreCache</span><span class="op">(</span>data.df<span class="op">=</span><span class="va">mydat</span>,</span></span>
<span class="r-in"><span>                              data.dists<span class="op">=</span><span class="va">mydists</span>,</span></span>
<span class="r-in"><span>                              dag.banned<span class="op">=</span> <span class="op">~</span><span class="va">b1</span><span class="op">|</span><span class="va">b2</span>, <span class="co"># ban arc from b2 to b1</span></span></span>
<span class="r-in"><span>                              dag.retained<span class="op">=</span> <span class="op">~</span><span class="va">g1</span><span class="op">|</span><span class="va">g2</span>, <span class="co"># always retain arc from g2 to g1</span></span></span>
<span class="r-in"><span>                              max.parents<span class="op">=</span><span class="va">max.par</span>,</span></span>
<span class="r-in"><span>                              method<span class="op">=</span><span class="st">"bayes"</span>,</span></span>
<span class="r-in"><span>                              control<span class="op">=</span><span class="fu"><a href="build.control.html">build.control</a></span><span class="op">(</span>max.mode.error<span class="op">=</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## comparison - very similar</span></span></span>
<span class="r-in"><span>  <span class="va">difference</span> <span class="op">&lt;-</span> <span class="va">res.c</span><span class="op">$</span><span class="va">mlik</span> <span class="op">-</span> <span class="va">res.inla</span><span class="op">$</span><span class="va">mlik</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">difference</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Comparison Bayes with MLE (unconstrained):</span></span></span>
<span class="r-in"><span><span class="va">res.mle</span> <span class="op">&lt;-</span> <span class="fu">buildScoreCache</span><span class="op">(</span>data.df<span class="op">=</span><span class="va">mydat</span>, data.dists<span class="op">=</span><span class="va">mydists</span>,</span></span>
<span class="r-in"><span>                           max.parents<span class="op">=</span><span class="fl">3</span>, method<span class="op">=</span><span class="st">"mle"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res.abn</span> <span class="op">&lt;-</span> <span class="fu">buildScoreCache</span><span class="op">(</span>data.df<span class="op">=</span><span class="va">mydat</span>, data.dists<span class="op">=</span><span class="va">mydists</span>,</span></span>
<span class="r-in"><span>                           max.parents<span class="op">=</span><span class="fl">3</span>, method<span class="op">=</span><span class="st">"bayes"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># of course different, but same order:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">-</span><span class="va">res.mle</span><span class="op">$</span><span class="va">bic</span>, <span class="va">res.abn</span><span class="op">$</span><span class="va">mlik</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#################################################################</span></span></span>
<span class="r-in"><span><span class="co">## Example 2 - mle with several cores</span></span></span>
<span class="r-in"><span><span class="co">#################################################################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Many variables, few observations</span></span></span>
<span class="r-in"><span><span class="va">mydat</span> <span class="op">&lt;-</span> <span class="va">ex0.dag.data</span></span></span>
<span class="r-in"><span><span class="va">mydists</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"binomial"</span>, <span class="st">"gaussian"</span>, <span class="st">"poisson"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mydists</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mydat</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">res.mle1</span> <span class="op">&lt;-</span> <span class="fu">buildScoreCache</span><span class="op">(</span>data.df<span class="op">=</span><span class="va">mydat</span>,</span></span>
<span class="r-in"><span>                              data.dists<span class="op">=</span><span class="va">mydists</span>,</span></span>
<span class="r-in"><span>                              max.parents<span class="op">=</span><span class="fl">2</span>,</span></span>
<span class="r-in"><span>                              method<span class="op">=</span><span class="st">"mle"</span>,</span></span>
<span class="r-in"><span>                              control <span class="op">=</span> <span class="fu"><a href="build.control.html">build.control</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"mle"</span>,</span></span>
<span class="r-in"><span>                                                      ncores<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">res.mle2</span> <span class="op">&lt;-</span> <span class="fu">buildScoreCache</span><span class="op">(</span>data.df<span class="op">=</span><span class="va">mydat</span>,</span></span>
<span class="r-in"><span>                              data.dists<span class="op">=</span><span class="va">mydists</span>,</span></span>
<span class="r-in"><span>                              max.parents<span class="op">=</span><span class="fl">2</span>,</span></span>
<span class="r-in"><span>                              method<span class="op">=</span><span class="st">"mle"</span>,</span></span>
<span class="r-in"><span>                              control <span class="op">=</span> <span class="fu"><a href="build.control.html">build.control</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"mle"</span>,</span></span>
<span class="r-in"><span>                                                      ncores<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#################################################################</span></span></span>
<span class="r-in"><span><span class="co">## Example 3 - grouped data - random effects example e.g. glmm</span></span></span>
<span class="r-in"><span><span class="co">#################################################################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## this data comes with abn see ?ex3.dag.data</span></span></span>
<span class="r-in"><span><span class="va">mydat</span> <span class="op">&lt;-</span> <span class="va">ex3.dag.data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"b1"</span>,<span class="st">"b2"</span>,<span class="st">"b3"</span>,<span class="st">"b4"</span>,<span class="st">"b5"</span>,<span class="st">"b6"</span>,<span class="st">"b7"</span>,</span></span>
<span class="r-in"><span>                         <span class="st">"b8"</span>,<span class="st">"b9"</span>,<span class="st">"b10"</span>,<span class="st">"b11"</span>,<span class="st">"b12"</span>,<span class="st">"b13"</span>, <span class="st">"group"</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">mydists</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>b1<span class="op">=</span><span class="st">"binomial"</span>, b2<span class="op">=</span><span class="st">"binomial"</span>, b3<span class="op">=</span><span class="st">"binomial"</span>,</span></span>
<span class="r-in"><span>                b4<span class="op">=</span><span class="st">"binomial"</span>, b5<span class="op">=</span><span class="st">"binomial"</span>, b6<span class="op">=</span><span class="st">"binomial"</span>, b7<span class="op">=</span><span class="st">"binomial"</span>,</span></span>
<span class="r-in"><span>                b8<span class="op">=</span><span class="st">"binomial"</span>, b9<span class="op">=</span><span class="st">"binomial"</span>, b10<span class="op">=</span><span class="st">"binomial"</span>,b11<span class="op">=</span><span class="st">"binomial"</span>,</span></span>
<span class="r-in"><span>                b12<span class="op">=</span><span class="st">"binomial"</span>, b13<span class="op">=</span><span class="st">"binomial"</span> <span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">max.par</span> <span class="op">&lt;-</span> <span class="fl">2</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## in this example INLA is used as default since these are glmm nodes</span></span></span>
<span class="r-in"><span><span class="co">## when running this at node-parent combination 71 the default accuracy check on the</span></span></span>
<span class="r-in"><span><span class="co">## INLA modes is exceeded (default is a max. of 10 percent difference from</span></span></span>
<span class="r-in"><span><span class="co">## modes estimated using internal code) and a message is given that internal code</span></span></span>
<span class="r-in"><span><span class="co">## will be used in place of INLA's results.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">mycache.bayes</span> <span class="op">&lt;-</span> <span class="fu">buildScoreCache</span><span class="op">(</span>data.df<span class="op">=</span><span class="va">mydat</span>,</span></span>
<span class="r-in"><span>                                 data.dists<span class="op">=</span><span class="va">mydists</span>,</span></span>
<span class="r-in"><span>                                 group.var<span class="op">=</span><span class="st">"group"</span>,</span></span>
<span class="r-in"><span>                                 method <span class="op">=</span> <span class="st">"bayes"</span>,</span></span>
<span class="r-in"><span>                                 max.parents<span class="op">=</span><span class="va">max.par</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dag.bayes</span> <span class="op">&lt;-</span> <span class="fu"><a href="mostProbable.html">mostProbable</a></span><span class="op">(</span>score.cache<span class="op">=</span><span class="va">mycache.bayes</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dag.bayes</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">mycache.mle</span> <span class="op">&lt;-</span> <span class="fu">buildScoreCache</span><span class="op">(</span>data.df<span class="op">=</span><span class="va">mydat</span>,</span></span>
<span class="r-in"><span>                               data.dists<span class="op">=</span><span class="va">mydists</span>,</span></span>
<span class="r-in"><span>                               group.var<span class="op">=</span><span class="st">"group"</span>,</span></span>
<span class="r-in"><span>                               method <span class="op">=</span> <span class="st">"mle"</span>,</span></span>
<span class="r-in"><span>                               max.parents<span class="op">=</span><span class="va">max.par</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dag.mle</span> <span class="op">&lt;-</span> <span class="fu"><a href="mostProbable.html">mostProbable</a></span><span class="op">(</span>score.cache<span class="op">=</span><span class="va">mycache.mle</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dag.mle</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Matteo Delucchi, Reinhard Furrer, Gilles Kratzer, Fraser Iain Lewis.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

